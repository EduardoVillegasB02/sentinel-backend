generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Action {
  APPROVE
  CREATE
  DELETE
  DOWNLOAD
  GET_ONE
  GET_ALL
  LOGIN
  LOGOUT
  REJECT
  RESTORE
  SEND
  UPDATE
}

enum Mode {
  JUSTIFIED
  UNJUSTIFIED
}

enum Model {
  AUDIT
  AUTH
  BODYCAM
  JOB
  JURISDICTION
  LACK
  LEAD
  OFFENDER
  REPORT
  SESSION
  SUBJECT
  USER
}

enum Process {
  APPROVED
  PENDING
  REJECTED
}

enum Rol {
  ADMINISTRATOR
  SUPERVISOR
  SENTINEL
  VALIDATOR
}

enum Shift {
  M
  T
  N
}

enum Status {
  BLOCKED
  FAILED
  SUCCESS
}

model Absence {
  id                    String                @id @default(uuid())
  date                  DateTime?
  offender_id           String
  mode                  Mode?
  offender              Offender              @relation(fields: [offender_id], references: [id])
  created_at            DateTime              @default(now())
  updated_at            DateTime              @updatedAt
  deleted_at            DateTime?
  @@index([offender_id])
}

model Audit {
  id                    String                @id @default(uuid())
  ip                    String
  description           String
  register_id           String?
  action                Action
  model                 Model
  status                Status                @default(SUCCESS)
  field                 String?
  preview_content       String?
  new_content           String?
  user_id               String?
  user                  User?                 @relation(fields: [user_id], references: [id])
  created_at            DateTime              @default(now())
  deleted_at            DateTime?
  @@index([action])
  @@index([model])
  @@index([status])
  @@index([user_id])
}

model Bodycam {
  id                    String                @id @default(uuid())
  name                  String                @unique()
  serie                 String?
  reports               Report[]
  created_at            DateTime              @default(now())
  updated_at            DateTime              @updatedAt
  deleted_at            DateTime?
}

model Evidence {
  id                    String                @id @default(uuid())
  description           String
  path                  String
  mimetype              String
  size                  Int
  report                Report                @relation(fields: [report_id], references: [id])
  report_id             String
  created_at            DateTime              @default(now())
  updated_at            DateTime              @updatedAt
  deleted_at            DateTime?
  @@index([report_id])
}

model Job {
  id                    String                @id @default(uuid())
  name                  String                @unique()
  leads                 Lead[]
  created_at            DateTime              @default(now())
  updated_at            DateTime              @updatedAt
  deleted_at            DateTime?
}

model Jurisdiction {
  id                    String                @id @default(uuid())
  name                  String                @unique()
  reports               Report[]
  created_at            DateTime              @default(now())
  updated_at            DateTime              @updatedAt
  deleted_at            DateTime?
}

model Lack {
  id                    String                @id @default(uuid())
  absence               Boolean               @default(false)
  article               String?
  content               String
  description           String?
  name                  String
  subject_id            String
  subject               Subject               @relation(fields: [subject_id], references: [id])
  reports               Report[]
  created_at            DateTime              @default(now())
  updated_at            DateTime              @updatedAt
  deleted_at            DateTime?
  @@index([subject_id])
}

model Lead {
  id                    String                @id @default(uuid())
  name                  String
  lastname              String
  job                   Job                   @relation(fields: [job_id], references: [id])
  job_id                String
  created_at            DateTime              @default(now())
  updated_at            DateTime              @updatedAt
  deleted_at            DateTime?
  @@index([job_id])
}

model Offender {
  id                    String                @id @default(uuid())
  name                  String
  lastname              String
  dni                   String                @unique()
  gestionate_id         Int
  subgerencia           String
  job                   String
  regime                String
  shift                 String
  absence               Boolean               @default(false)
  absences              Absence[]
  reports               Report[]
  created_at            DateTime              @default(now())
  updated_at            DateTime              @updatedAt
  deleted_at            DateTime?
}

model Report {
  id                    String                @id @default(uuid())
  address               String
  code                  String?               @unique()
  date                  DateTime
  bodycam_user          String?
  bodycam_supervisor    String?
  header                Json
  latitude              Float
  longitude             Float
  link                  String?
  message               String?
  process               Process?
  shift                 Shift?
  bodycam               Bodycam?              @relation(fields: [bodycam_id], references: [id])
  bodycam_id            String?
  jurisdiction          Jurisdiction          @relation(fields: [jurisdiction_id], references: [id])
  jurisdiction_id       String
  lack                  Lack                  @relation(fields: [lack_id], references: [id])
  lack_id               String
  offender              Offender              @relation(fields: [offender_id], references: [id])
  offender_id           String
  subject               Subject               @relation(fields: [subject_id], references: [id])
  subject_id            String
  user                  User                  @relation(fields: [user_id], references: [id])
  user_id               String
  evidences             Evidence[]
  created_at            DateTime              @default(now())
  updated_at            DateTime              @updatedAt
  deleted_at            DateTime?
  @@index([bodycam_id])
  @@index([jurisdiction_id])
  @@index([lack_id])
  @@index([offender_id])
  @@index([subject_id])
  @@index([user_id])
}

model Session {
  id                    String                @id @default(uuid())
  ip                    String
  token                 String
  user_id               String
  user                  User                  @relation(fields: [user_id], references: [id])
  created_at            DateTime              @default(now())
  expires_at            DateTime?
  deleted_at            DateTime?
  @@index([user_id])
}

model Subject {
  id                    String                @id @default(uuid())
  name                  String                @unique()
  lacks                 Lack[]
  reports               Report[]
  created_at            DateTime              @default(now())
  updated_at            DateTime              @updatedAt
  deleted_at            DateTime?
}

model User {
  id                    String                @id @default(uuid())
  username              String                @unique
  password              String
  name                  String
  lastname              String
  email                 String                @unique
  dni                   String?               @unique
  phone                 String?               @unique
  max_ips               Int                   @default(1)
  rol                   Rol
  audits                Audit[]
  reports               Report[]
  sessions              Session[]
  created_at            DateTime              @default(now())
  updated_at            DateTime              @updatedAt
  deleted_at            DateTime?
  @@index([rol])
}
